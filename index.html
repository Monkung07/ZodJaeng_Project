<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Party Game">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/931/931949.png">

    <title>Zod *! Jaeng Party</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style id="dynamic-card-style"></style>

    <style>
        /* --- CSS Variables --- */
        :root {
            --bg-color: #111111;
            --dot-color: rgba(255, 255, 255, 0.15);
            --accent: #FACC15;
            /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á Zod */
            --text-on-accent: #000000;
            --glass-bg: rgba(30, 30, 30, 0.95);
        }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î (Polka Dot) ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß --- */
        html,
        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--dot-color) 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î */
            background-position: 0 0;

            overflow: hidden;
            user-select: none;
            font-family: 'Sarabun', sans-serif;
            touch-action: none;
            -ms-touch-action: none;
            overscroll-behavior: none;
            -webkit-touch-callout: none;
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transition: background 0.3s ease;
        }

        .scene {
            perspective: 1200px;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .deck-container {
            position: relative;
            width: 220px;
            height: 330px;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 1rem;
            transform-style: preserve-3d;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            -webkit-tap-highlight-color: transparent;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 1rem;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î --- */
        .card-back {
            background-color: #000;
            /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥ */
            background-image: url('cover.png');
            /* ‡∏£‡∏π‡∏õ‡∏õ‡∏Å */
            background-size: cover;
            background-position: center;
            border: 6px solid white;
            /* ‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß */
            transition: background 0.5s ease;
        }

        .card-back::after {
            display: none;
        }

        /* ‡∏ã‡πà‡∏≠‡∏ô‡∏î‡∏≠‡∏Å‡∏à‡∏¥‡∏Å */

        .card-front {
            background: white;
            transform: rotateY(180deg);
            color: #1a1a1a;
            font-size: 1.5rem;
            font-weight: bold;
            border: 4px solid #e5e7eb;
        }

        .card.active {
            z-index: 3000 !important;
            transform: translate(0, -40px) scale(1.25) rotateY(180deg) !important;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.8);
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .card.discarded {
            transform: translate(-150%, 0) rotate(-45deg) !important;
            opacity: 0;
            transition: all 0.4s ease-in;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .text-pop {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ */
        .side-btn {
            background: rgba(50, 50, 50, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 9999px;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
        }

        .side-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .side-btn:active {
            transform: scale(0.95);
        }

        .side-btn span {
            font-size: 24px;
            color: var(--accent);
        }

        .side-btn p {
            font-size: 10px;
            margin-top: 4px;
            font-weight: bold;
            color: white;
        }

        @media (min-width: 768px) {
            .deck-container {
                width: 300px;
                height: 450px;
            }

            .side-btn {
                width: 90px;
                height: 90px;
            }

            .side-btn span {
                font-size: 32px;
            }

            .side-btn p {
                font-size: 12px;
            }
        }

        /* Modal UI */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .custom-select-trigger {
            width: 100%;
            padding: 12px;
            border-radius: 0.75rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .custom-options {
            position: absolute;
            top: 110%;
            left: 0;
            right: 0;
            background: #222;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            overflow: hidden;
            z-index: 50;
            display: none;
        }

        .custom-options.open {
            display: block;
        }

        .custom-option {
            padding: 12px;
            cursor: pointer;
            color: white;
            display: flex;
            gap: 8px;
        }

        .custom-option.selected {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent);
        }

        /* Theme Buttons */
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #000;
        }

        .theme-btn-inner {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .theme-btn.active {
            border-color: white;
            transform: scale(1.15);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* File Upload */
        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
    </style>
</head>

<body>

    <div class="fixed top-12 w-full text-center z-40 pointer-events-none px-12">
        <h1 id="status-text"
            class="text-3xl md:text-5xl font-bold drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] text-pop leading-tight"
            style="color: var(--accent);">
            ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß... ‡∏à‡∏±‡πà‡∏ß‡πÄ‡∏•‡∏¢!
        </h1>
        <p id="card-count" class="text-white/60 text-sm mt-2 font-bold"></p>
    </div>

    <div class="fixed right-4 top-1/2 transform -translate-y-1/2 z-50 flex flex-col items-center">
        <button onclick="toggleModal(true)" class="side-btn">
            <span class="material-icons-round">edit</span>
            <p>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</p>
        </button>
        <button id="btn-shuffle" onclick="startShuffleSequence()" class="side-btn">
            <span class="material-icons-round">shuffle</span>
            <p>‡∏™‡∏±‡∏ö‡πÑ‡∏û‡πà</p>
        </button>
        <button onclick="instantRestart()" class="side-btn">
            <span class="material-icons-round">replay</span>
            <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</p>
        </button>
    </div>

    <div class="scene">
        <div class="deck-container" id="deck"></div>
    </div>

    <div id="custom-modal" class="fixed inset-0 z-[100] hidden bg-black/80 flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-md p-6 rounded-2xl text-white">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold drop-shadow-sm flex items-center gap-2" style="color: var(--accent);">
                    <span class="material-icons-round">settings</span> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°
                </h2>
                <button onclick="toggleModal(false)" class="text-white/50 hover:text-white transition">
                    <span class="material-icons-round">close</span>
                </button>
            </div>

            <div class="space-y-6">

                <div>
                    <label
                        class="text-xs text-white/60 uppercase tracking-wider font-bold mb-2 block">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏û‡πà</label>
                    <div class="flex gap-2">
                        <label class="file-upload-label flex-1">
                            <span class="material-icons-round" style="color: var(--accent);">add_photo_alternate</span>
                            <span id="upload-text">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</span>
                            <input type="file" class="hidden" accept="image/*" onchange="handleImageUpload(this)">
                        </label>
                        <button onclick="resetCardBack()"
                            class="px-4 rounded-xl border border-white/20 text-white/50 hover:text-white hover:bg-white/10">
                            <span class="material-icons-round">refresh</span>
                        </button>
                    </div>
                </div>

                <hr class="border-white/10">

                <div>
                    <label class="text-xs text-white/60 uppercase tracking-wider font-bold mb-2 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ò‡∏µ‡∏°
                        (Accent)</label>
                    <div class="flex gap-3 justify-center bg-black/40 p-3 rounded-xl border border-white/10">
                        <div class="theme-btn" onclick="setTheme('zod')" id="theme-zod">
                            <div class="theme-btn-inner" style="background: #FACC15;"></div>
                        </div>
                        <div class="theme-btn" onclick="setTheme('red')" id="theme-red">
                            <div class="theme-btn-inner" style="background: #EF4444;"></div>
                        </div>
                        <div class="theme-btn" onclick="setTheme('blue')" id="theme-blue">
                            <div class="theme-btn-inner" style="background: #3B82F6;"></div>
                        </div>
                        <div class="theme-btn" onclick="setTheme('purple')" id="theme-purple">
                            <div class="theme-btn-inner" style="background: #8B5CF6;"></div>
                        </div>
                    </div>
                </div>

                <hr class="border-white/10">

                <div>
                    <label
                        class="text-xs text-white/60 uppercase tracking-wider font-bold mb-2 block">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡∏°‡πà</label>
                    <div class="space-y-3">
                        <input type="text" id="inp-text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÇ‡∏î‡∏ô 2 ‡πÅ‡∏Å‡πâ‡∏ß..."
                            class="w-full p-3 rounded-xl">
                        <div class="flex gap-3">
                            <div class="w-2/3 relative">
                                <div class="custom-select-trigger" onclick="toggleCustomSelect()">
                                    <span id="selected-val-display" class="flex items-center gap-2">üç∫ ‡∏î‡∏∑‡πà‡∏°
                                        (Drink)</span>
                                    <span class="material-icons-round text-sm">expand_more</span>
                                </div>
                                <div class="custom-options" id="custom-options-list">
                                    <div class="custom-option selected"
                                        onclick="selectOption('drink', 'üç∫ ‡∏î‡∏∑‡πà‡∏° (Drink)')">üç∫ ‡∏î‡∏∑‡πà‡∏° (Drink)</div>
                                    <div class="custom-option" onclick="selectOption('hard', 'üî• ‡πÇ‡∏´‡∏î (Hard)')">üî• ‡πÇ‡∏´‡∏î
                                        (Hard)</div>
                                    <div class="custom-option" onclick="selectOption('action', 'üíÉ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Action)')">
                                        üíÉ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Action)</div>
                                    <div class="custom-option" onclick="selectOption('lucky', 'üçÄ ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß (Lucky)')">üçÄ
                                        ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß (Lucky)</div>
                                </div>
                                <input type="hidden" id="inp-type" value="drink">
                            </div>
                            <input type="number" id="inp-count" value="1" min="1" max="50"
                                class="w-1/3 p-3 rounded-xl text-center">
                        </div>
                        <button onclick="addCustomCard()"
                            class="w-full font-bold py-3 rounded-xl shadow-lg transition transform active:scale-95"
                            style="background-color: var(--accent); color: var(--text-on-accent);">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏≠‡∏á
                        </button>
                    </div>
                </div>

                <hr class="border-white/10">

                <div class="flex flex-col gap-3">
                    <div class="flex justify-between text-sm text-white/60 px-1">
                        <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á: <strong id="custom-count-display" style="color: var(--accent);">0</strong>
                            ‡πÉ‡∏ö</span>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="openConfirm('clearCustom')"
                            class="flex-1 py-3 border border-red-500/40 text-red-300 rounded-xl hover:bg-red-500/20 text-sm font-bold">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        <button onclick="applyAndClose()"
                            class="flex-[2] py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl shadow-lg font-bold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-[110] hidden bg-black/80 flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-sm p-6 rounded-2xl text-center">
            <h3 id="confirm-title" class="text-xl font-bold text-white mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?</h3>
            <p id="confirm-desc" class="text-white/60 text-sm mb-6">...</p>
            <div class="flex gap-3">
                <button onclick="closeConfirm()"
                    class="flex-1 py-2 rounded-lg border border-white/20 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-yes-btn"
                    class="flex-1 py-2 rounded-lg bg-red-500 text-white font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('gesturestart', function (e) { e.preventDefault(); });
        document.addEventListener('dblclick', function (e) { e.preventDefault(); }, { passive: false });

        // --- Sound System ---
        const SoundFX = {
            ctx: null, buffer: null,
            init: function () {
                if (!this.ctx) { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
                if (this.ctx.state === 'suspended') this.ctx.resume();
                if (!this.buffer) {
                    const duration = 0.1; const sampleRate = this.ctx.sampleRate;
                    const buffer = this.ctx.createBuffer(1, sampleRate * duration, sampleRate);
                    const data = buffer.getChannelData(0);
                    for (let i = 0; i < data.length; i++) { data[i] = (Math.random() * 2 - 1) * 0.1; }
                    this.buffer = buffer;
                }
            },
            playSnap: function () { this.playNoise(800); },
            playSlide: function () { this.playOsc(150, 'triangle', 0.2); },
            playTone: function (freq) { this.playOsc(freq, 'sine', 0.3); },
            playNoise: function (freq) {
                if (!this.ctx || !this.buffer) return;
                const src = this.ctx.createBufferSource(); src.buffer = this.buffer;
                const f = this.ctx.createBiquadFilter(); f.type = 'highpass'; f.frequency.value = freq;
                const g = this.ctx.createGain(); g.gain.setValueAtTime(0.8, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.04);
                src.connect(f); f.connect(g); g.connect(this.ctx.destination);
                src.start(); src.stop(this.ctx.currentTime + 0.1);
            },
            playOsc: function (freq, type, dur) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator(); osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                const g = this.ctx.createGain(); g.gain.setValueAtTime(0.1, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
                osc.connect(g); g.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + dur);
            }
        };

        // --- Themes ---
        const themes = {
            zod: { '--accent': '#FACC15', '--text-on-accent': '#000000' },
            red: { '--accent': '#EF4444', '--text-on-accent': '#FFFFFF' },
            blue: { '--accent': '#3B82F6', '--text-on-accent': '#FFFFFF' },
            purple: { '--accent': '#8B5CF6', '--text-on-accent': '#FFFFFF' }
        };

        function setTheme(themeName) {
            const theme = themes[themeName] || themes.zod;
            const root = document.documentElement;
            for (const [key, value] of Object.entries(theme)) { root.style.setProperty(key, value); }
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`theme-${themeName}`)?.classList.add('active');
            appData.currentTheme = themeName;
            saveData();
        }

        // --- Data ---
        const defaultDeckData = [
            { text: "‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏Ç‡∏ß‡∏≤‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡∏ß‡∏≤‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏Ç‡∏ß‡∏≤‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡∏ß‡∏≤‡πÇ‡∏î‡∏ô", type: "drink" },

            { text: "‡πÉ‡∏Ñ‡∏£‡πÅ‡∏ö‡∏ï‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î ‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡πÉ‡∏Ñ‡∏£‡πÅ‡∏ö‡∏ï‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡∏™‡∏∏‡∏î ‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÉ‡∏™‡πà‡πÅ‡∏ß‡πà‡∏ô‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡πÅ‡∏ß‡πà‡∏ô‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡πÉ‡∏Ñ‡∏£‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÇ‡∏î‡∏ô 1 ‡πÅ‡∏Å‡πâ‡∏ß", type: "drink" },
            { text: "‡πÉ‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ iPhone ‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏Ñ‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÇ‡∏™‡∏î‡πÇ‡∏î‡∏ô 1 ‡πÅ‡∏Å‡πâ‡∏ß", type: "drink" },
            { text: "‡πÉ‡∏Ñ‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏î‡∏µ‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡πÉ‡∏Ñ‡∏£‡∏û‡∏Å‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏á‡∏Ñ‡πå‡∏°‡∏≤ ‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏Ñ‡∏ô‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡πÇ‡∏î‡∏ô", type: "drink" },
            { text: "‡∏ö‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏Ñ‡∏ô‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏° ‡∏ñ‡πâ‡∏≤‡∏ú‡∏¥‡∏î‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡∏ú‡∏•‡∏±‡∏î‡∏Å‡∏±‡∏ô‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 1-25 ‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏Ñ‡∏ô‡∏•‡∏∞ 1-3 ‡πÄ‡∏•‡∏Ç ‡πÉ‡∏Ñ‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 25 ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡∏ö‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢ '‡∏ö‡∏∏‡∏£‡∏µ' ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡∏ö‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡∏ö‡∏≠‡∏Å‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏£‡∏ñ ‡∏´‡πâ‡∏≤‡∏°‡∏ã‡πâ‡∏≥ (‡πÉ‡∏Ñ‡∏£‡∏ô‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏ô)", type: "action" },
            { text: "‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö‡∏Ñ‡∏ô‡∏Ç‡∏ß‡∏≤ ‡πÅ‡∏û‡πâ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏û‡πâ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏ó‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Å‡πâ‡∏≠‡∏¢‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ ‡πÅ‡∏û‡πâ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡∏ß‡∏≤‡∏î‡∏µ‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏≤‡∏Å 1 ‡∏ó‡∏µ", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏≥ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏ó‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏ó‡∏≤‡∏¢ ‡∏ó‡∏≤‡∏¢‡∏ú‡∏¥‡∏î‡πÇ‡∏î‡∏ô‡∏Ñ‡∏π‡πà", type: "action" },
            { text: "‡∏•‡∏á‡∏™‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÑ‡∏≠‡∏à‡∏µ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°", type: "action" },
            { text: "‡∏≠‡∏°‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á 1 ‡∏Å‡πâ‡∏≠‡∏ô", type: "action" },
            { text: "‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏¥‡∏õ‡∏°‡∏±‡∏á‡∏Ñ‡πå‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ", type: "action" },
            { text: "‡∏ó‡∏≤‡∏¢‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡∏≠‡∏ö ‡∏ó‡∏≤‡∏¢‡∏ú‡∏¥‡∏î‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏¢‡∏∑‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô ‡∏¢‡∏∑‡∏ô‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ ‡∏û‡∏π‡∏î‡∏•‡∏≤‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏Ñ‡∏ô‡πÅ‡∏û‡πâ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏ó‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏á‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏ö 1 ‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á ‡∏Ñ‡∏ô‡πÅ‡∏û‡πâ‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡πÄ‡∏•‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", type: "action" },
            { text: "‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏õ‡∏µ 2026", type: "action" },
            { text: "‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏õ‡∏µ 2026", type: "action" },
            { text: "‡πÄ‡∏•‡πà‡∏≤‡∏ß‡πà‡∏≤ ‡∏ï‡∏≠‡∏ô‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á", type: "action" },
            { text: "‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏Ñ‡∏£?", type: "action" },
            { text: "‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ß‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≤‡∏¢‡∏ñ‡∏π‡∏Å‡πÇ‡∏î‡∏ô", type: "action" },
            { text: "‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ä‡∏ó‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤ ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ü‡∏±‡∏á(‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÇ‡∏î‡∏ô)", type: "action" },
            { text: "‡∏≠‡∏±‡∏î‡∏™‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á‡∏ß‡πà‡∏≤ ‡∏ó‡∏≥‡πÑ‡∏°‡∏ô‡∏Å‡∏û‡∏¥‡∏£‡∏≤‡∏ö‡∏ñ‡∏∂‡∏á‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏¢‡∏∂‡∏î‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏•‡∏Å(‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÇ‡∏î‡∏ô)", type: "action" },
            { text: "‡∏á‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô 1 ‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á (‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÇ‡∏î‡∏ô)", type: "action" },
            { text: "‡∏°‡∏¥‡∏ô‡∏¥‡πÄ‡∏Å‡∏° ‡∏Ñ‡∏≥‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°", type: "action" },
            { text: "‡∏™‡∏∏‡πà‡∏°‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏î‡∏π", type: "action" },
            { text: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏ß 1 ‡∏ù‡∏≤", type: "hard" },
            { text: "‡∏Å‡∏¥‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏ß 1 ‡∏ù‡∏≤", type: "hard" },
            { text: "‡∏ú‡∏™‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÇ‡∏î‡∏ô", type: "hard" },
            { text: "‡∏ú‡∏™‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Ç‡∏ß‡∏≤‡πÇ‡∏î‡∏ô", type: "hard" },
            { text: "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏° (‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏ô)", type: "hard" },
            { text: "‡∏Ñ‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ Google (‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÇ‡∏î‡∏ô)", type: "hard" },
            { text: "‡∏ö‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÅ‡∏ü‡∏ô", type: "hard" },
            { text: "‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏π‡∏õ‡πÄ‡∏ó‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏•‡∏á‡∏™‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô Sexy?ü´¶(‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏ô)", type: "hard" },
            { text: "‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ß‡∏á‡∏î‡∏π DM ‡πÉ‡∏ô Instagram ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏ô)", type: "hard" },
            { text: "‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤ Sexy ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏ô)", type: "hard" },
            { text: "Free Turn! ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ", type: "lucky" },
            { text: "Free Turn! ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ", type: "lucky" },
            { text: "‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏ô 1 ‡πÅ‡∏Å‡πâ‡∏ß", type: "lucky" },
            { text: "Free Turn! ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ", type: "lucky" },
            { text: "Free Turn! ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ", type: "lucky" },
            { text: "‡∏™‡∏±‡πà‡∏á‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏ô 1 ‡πÅ‡∏Å‡πâ‡∏ß", type: "lucky" },
            { text: "‡∏û‡∏±‡∏Å‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤", type: "lucky" }
        ];

        let appData = { customCards: [], currentTheme: 'zod', customCardBack: null };
        let activeDeck = []; let currentDeckState = [];
        let isShuffling = false;

        const reactionMap = {
            hard: ["‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏£‡∏¢‡πå!", "‡∏™‡∏π‡πà‡∏Ç‡∏¥‡∏ï...", "‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏¢‡∏¢‡∏¢‡∏¢‡∏¢", "‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏ù‡∏∑‡∏ô"],
            drink: ["‡∏Ñ‡∏≠‡πÅ‡∏´‡πâ‡∏á‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏•‡∏¢", "‡∏´‡∏ß‡∏≤‡∏ô‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö‡∏ö‡∏ö", "‡∏ä‡∏ô‡πÅ‡∏Å‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏°", "‡πÄ‡∏ö‡∏≤‡πÜ ‡∏Å‡∏£‡∏∏‡∏ö‡∏Å‡∏£‡∏¥‡∏ö"],
            action: ["‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ç‡∏¥‡∏ô‡∏î‡∏¥‡∏ß‡∏∞!", "‡πÄ‡∏≠‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏∏‡∏î!", "‡∏Å‡∏•‡πâ‡∏≤‡∏õ‡πà‡∏≤‡∏ß‡∏ß‡∏ß?", "‡∏Ç‡∏≠‡∏ï‡∏∂‡∏á‡πÜ ‡∏ô‡∏∞"],
            lucky: ["‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡∏°‡∏≤?", "‡∏£‡∏≠‡∏î‡πÄ‡∏â‡∏¢‡∏¢‡∏¢‡∏¢", "‡πÅ‡∏ï‡πâ‡∏°‡∏ö‡∏∏‡∏ç‡∏™‡∏π‡∏á‡∏ô‡∏∞‡πÄ‡∏£‡∏≤", "‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡∏´‡∏ß‡∏¢‡∏≠‡∏≠‡∏Å‡πÅ‡∏ô‡πà"]
        };
        const waitingTexts = ["‡∏ï‡∏≤‡πÉ‡∏Ñ‡∏£‡πÄ‡∏≠‡πà‡∏¢?", "‡∏°‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏ô‡∏ó‡∏≥‡πÑ‡∏°?", "‡πÉ‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÇ‡∏´‡∏î‡πÅ‡∏ô‡πà", "‡∏´‡∏¢‡∏¥‡∏ö‡∏™‡∏¥ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏µ‡∏•‡∏≤"];

        const deckContainer = document.getElementById('deck');
        const statusText = document.getElementById('status-text');
        const countText = document.getElementById('card-count');
        const modal = document.getElementById('custom-modal');
        const confirmModal = document.getElementById('confirm-modal');

        // --- Functions ---
        function loadData() {
            const saved = localStorage.getItem('party_game_data_zod');
            if (saved) { try { appData = { ...appData, ...JSON.parse(saved) }; } catch (e) { resetData(); } }
            setTheme(appData.currentTheme || 'zod');
            applyCardBack(appData.customCardBack);
            updateModalUI();
        }
        function saveData() { localStorage.setItem('party_game_data_zod', JSON.stringify(appData)); updateModalUI(); }
        function resetData() { appData = { customCards: [], currentTheme: 'zod', customCardBack: null }; saveData(); }

        function updateModalUI() {
            document.getElementById('custom-count-display').innerText = appData.customCards.length;
            document.getElementById('upload-text').innerText = appData.customCardBack ? "‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà" : "‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà";
        }

        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            if (file.size > 2 * 1024 * 1024) return alert("‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏õ! ‡∏Ç‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB");
            const reader = new FileReader();
            reader.onload = (e) => {
                appData.customCardBack = e.target.result;
                applyCardBack(e.target.result);
                saveData();
            };
            reader.readAsDataURL(file);
        }
        function resetCardBack() { appData.customCardBack = null; applyCardBack(null); saveData(); }
        function applyCardBack(imgUrl) {
            const style = document.getElementById('dynamic-card-style');
            if (imgUrl) style.innerHTML = `.card-back { background-image: url(${imgUrl}) !important; background-size: cover !important; background-position: center !important; border: 6px solid white !important; } .card-back::after { display: none !important; }`;
            else style.innerHTML = '';
        }

        function toggleModal(show) { modal.classList.toggle('hidden', !show); if (show) updateModalUI(); }
        function openConfirm(action) {
            confirmModal.classList.remove('hidden');
            const btnYes = document.getElementById('confirm-yes-btn');
            const title = document.getElementById('confirm-title');
            const desc = document.getElementById('confirm-desc');

            if (action === 'clearCustom') {
                title.innerText = "‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°?"; desc.innerText = "‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ";
                btnYes.onclick = () => { appData.customCards = []; saveData(); closeConfirm(); };
            }
        }
        function closeConfirm() { confirmModal.classList.add('hidden'); }
        function applyAndClose() { instantRestart(); toggleModal(false); }

        function toggleCustomSelect() { document.getElementById('custom-options-list').classList.toggle('open'); }
        function selectOption(value, text) {
            document.getElementById('inp-type').value = value;
            document.getElementById('selected-val-display').innerText = text;
            document.querySelectorAll('.custom-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            toggleCustomSelect();
        }
        window.onclick = (e) => {
            if (!e.target.matches('.custom-select-trigger') && !e.target.matches('.custom-select-trigger *')) {
                document.getElementById('custom-options-list').classList.remove('open');
            }
        };

        function addCustomCard() {
            const text = document.getElementById('inp-text').value.trim();
            const type = document.getElementById('inp-type').value;
            const count = parseInt(document.getElementById('inp-count').value);
            if (!text) return alert("‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö!");
            for (let i = 0; i < count; i++) appData.customCards.push({ text, type });
            saveData();
            document.getElementById('inp-text').value = '';
            // Feedback
            const btn = document.querySelector('button[onclick="addCustomCard()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = "<span class='material-icons-round'>check</span> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
            setTimeout(() => btn.innerHTML = originalText, 1000);
        }

        function updateStatus(mode, category = null) {
            let text = "";
            statusText.className = "text-3xl md:text-5xl font-bold drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] leading-tight text-pop";

            if (mode === 'waiting') {
                text = currentDeckState.length === 0 ? "‡∏´‡∏°‡∏î‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!" : waitingTexts[Math.floor(Math.random() * waitingTexts.length)];
                statusText.style.color = currentDeckState.length === 0 ? 'gray' : 'var(--accent)';
                document.getElementById('btn-shuffle').disabled = currentDeckState.length === 0;
            } else if (mode === 'reaction') {
                const options = reactionMap[category] || reactionMap['drink'];
                text = options[Math.floor(Math.random() * options.length)];
                if (category === 'hard') statusText.style.color = '#EF4444';
                else if (category === 'lucky') statusText.style.color = '#10B981';
                else statusText.style.color = '#EC4899';
            }
            statusText.innerText = text;
            countText.innerText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${currentDeckState.length} ‡πÉ‡∏ö`;
        }

        function instantRestart() {
            if (isShuffling) return;
            SoundFX.init(); SoundFX.playSlide();
            activeDeck = [...defaultDeckData, ...appData.customCards].map((c, i) => ({ ...c, id: i }));
            currentDeckState = [...activeDeck];
            deployRealDeck();
            updateStatus('waiting');
        }

        function startShuffleSequence() {
            if (isShuffling || currentDeckState.length === 0) return;
            isShuffling = true; SoundFX.init();
            deckContainer.innerHTML = ''; updateStatus('waiting');
            const STUNT_COUNT = Math.min(8, currentDeckState.length);
            const stuntCards = [];

            for (let i = 0; i < STUNT_COUNT; i++) {
                const c = document.createElement('div'); c.className = 'card';
                c.innerHTML = `<div class="card-face card-back"></div>`;
                deckContainer.appendChild(c); stuntCards.push(c);
            }

            stuntCards.forEach((c, i) => {
                setTimeout(() => {
                    SoundFX.playSnap();
                    c.style.transition = 'transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    c.style.transform = `translate(${(i - STUNT_COUNT / 2) * 25}px, -110px) rotate(${(i - STUNT_COUNT / 2) * 5}deg)`;
                }, i * 30);

                setTimeout(() => {
                    c.style.transition = 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    c.style.transform = `translate(0,0) rotate(${Math.random() * 2 - 1}deg)`;
                }, (STUNT_COUNT * 30) + 500 + (i * 50));
            });

            setTimeout(() => { deployRealDeck(); isShuffling = false; }, (STUNT_COUNT * 30) + 500 + (STUNT_COUNT * 50) + 800);
        }

        function deployRealDeck() {
            deckContainer.innerHTML = '';
            [...currentDeckState].sort(() => Math.random() - 0.5).forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card'; card.style.zIndex = index + 1;
                card.dataset.id = item.id; card.dataset.type = item.type;
                card.style.transform = `translate(0,0) rotate(${Math.random() * 2 - 1}deg)`;
                card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front"><div class="flex flex-col items-center px-4"><span class="text-3xl mb-4">üçª</span><span>${item.text}</span></div></div>`;
                card.onclick = () => handleCardClick(card);
                deckContainer.appendChild(card);
            });
            countText.innerText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${currentDeckState.length} ‡πÉ‡∏ö`;
        }

        function handleCardClick(card) {
            if (isShuffling || card.classList.contains('discarded')) return;
            SoundFX.init();

            if (card.classList.contains('active')) {
                SoundFX.playSlide(); card.classList.remove('active'); card.classList.add('discarded');
                currentDeckState = currentDeckState.filter(c => c.id !== parseInt(card.dataset.id));
                countText.innerText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${currentDeckState.length} ‡πÉ‡∏ö`;
                setTimeout(() => updateStatus('waiting'), 300); setTimeout(() => card.remove(), 600);
            } else {
                const next = card.nextElementSibling;
                if (!next || next.classList.contains('discarded')) {
                    card.classList.add('active');
                    updateStatus('reaction', card.dataset.type);
                    const t = card.dataset.type;
                    if (t === 'hard') SoundFX.playTone(100); // Sawtooth approx
                    else if (t === 'lucky') SoundFX.playTone(600);
                    else SoundFX.playTone(400);
                }
            }
        }

        loadData();
        setTimeout(() => instantRestart(), 100);
    </script>
</body>


</html>
